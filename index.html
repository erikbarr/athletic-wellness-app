<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Athletic Wellness Assessment</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;


        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            margin: -20px -20px 20px -20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .nav-tab {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .nav-tab:hover {
            color: #667eea;
        }

        .nav-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: 600;
        }

        .content-area {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .hidden {
            display: none;
        }

        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: 700;
        }

        .recent-evaluations {
            margin-top: 30px;
        }

        .eval-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .eval-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .eval-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .score-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 600;
        }

        .score-good {
            background: #d4edda;
            color: #155724;
        }

        .score-warning {
            background: #fff3cd;
            color: #856404;
        }

        .score-danger {
            background: #f8d7da;
            color: #721c24;
        }

        /* Member Form */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Evaluation Form */
        .evaluation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .overall-score {
            font-size: 48px;
            font-weight: 700;
            color: #667eea;
        }

        .group-section {
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .group-header:hover {
            background: #e9ecef;
        }

        .group-header h3 {
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .group-total {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
        }

        .group-content {
            padding: 20px;
        }

        .segment-table {
            width: 100%;
            margin-bottom: 20px;
        }

        .segment-table th,
        .segment-table td {
            padding: 10px;
            text-align: left;
        }

        .segment-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
        }

        .segment-input {
            width: 60px;
            padding: 5px 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            text-align: center;
            font-size: 16px;
        }

        .segment-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .segment-score {
            font-weight: 600;
            color: #667eea;
        }

        .modifier-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .modifier-label {
            font-weight: 600;
            color: #555;
        }

        .modifier-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modifier-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .modifier-btn:hover {
            background: #667eea;
            color: white;
        }

        .modifier-value {
            font-size: 24px;
            font-weight: 700;
            color: #333;
            min-width: 40px;
            text-align: center;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        #voice-record-btn {
            background: #17a2b8;
            border-color: #17a2b8;
            color: white;
            display: inline-block;
            margin-left: 10px;
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #voice-record-btn:hover {
            background: #138496;
            border-color: #117a8b;
            transform: translateY(-1px);
        }

        #voice-record-btn:disabled {
            background: #6c757d;
            border-color: #6c757d;
            cursor: not-allowed;
        }

        #recording-status {
            animation: pulse 1.5s infinite;
            color: #dc3545;
            font-weight: normal;
            margin-left: 10px;
        }

        #voice-transcript {
            margin-top: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
            display: none;
        }

        #transcript-text {
            margin: 5px 0;
            color: #333;
            line-height: 1.4;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        /* Results View */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .score-gauge {
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .gauge-value {
            font-size: 72px;
            font-weight: 700;
            color: #667eea;
        }

        .group-breakdown {
            padding: 20px;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .breakdown-bar {
            flex: 1;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 0 15px;
            position: relative;
            overflow: hidden;
        }

        .breakdown-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-in {
            animation: slideIn 0.5s ease;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-grid,
            .results-grid,
            .form-row {
                grid-template-columns: 1fr;
            }

            .group-header {
                flex-direction: column;
                gap: 10px;
            }

            .segment-table {
                font-size: 14px;
            }

            .segment-input {
                width: 50px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Athletic Wellness Assessment</h1>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">Dashboard</button>
            <button class="nav-tab" onclick="showTab('members')">Members</button>
            <button class="nav-tab" onclick="showTab('evaluation')">New Evaluation</button>
            <button class="nav-tab" onclick="showTab('results')">Results</button>
            <button class="nav-tab" onclick="showTab('settings')">Settings</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard-content" class="content-area">
            <div class="dashboard-grid">
                <div class="stat-card">
                    <h3>Total Members</h3>
                    <div class="value" id="total-members">0</div>
                </div>
                <div class="stat-card">
                    <h3>Evaluations This Week</h3>
                    <div class="value" id="weekly-evals">0</div>
                </div>
            </div>

            <div class="recent-evaluations">
                <h2>Recent Evaluations</h2>
                <div class="eval-list" id="recent-evals">
                    <p style="text-align: center; color: #999; padding: 20px;">No evaluations yet. Start by adding a member!</p>
                </div>
            </div>
        </div>

        <!-- Members Tab -->
        <div id="members-content" class="content-area hidden">
            <div id="member-list-view">
                <h2>Add New Member</h2>
                <div id="member-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="first-name">First Name</label>
                            <input type="text" class="form-control" id="first-name" required>
                        </div>
                        <div class="form-group">
                            <label for="last-name">Last Name</label>
                            <input type="text" class="form-control" id="last-name" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="dob">Date of Birth</label>
                        <input type="date" class="form-control" id="dob" required>
                    </div>
                    <div class="action-buttons">
                        <button type="button" class="btn btn-primary" onclick="addMember()">Add Member</button>
                    </div>
                </div>

                <div style="margin-top: 40px;">
                    <h2>Member List</h2>
                    <div style="margin-bottom: 20px;">
                        <input type="text" 
                               class="search-input" 
                               id="member-list-search" 
                               placeholder="Search members by name..." 
                               onkeyup="searchMemberList()">
                    </div>
                    <div id="member-list" class="eval-list">
                        <p style="text-align: center; color: #999; padding: 20px;">No members added yet.</p>
                    </div>
                </div>
            </div>

            <!-- Member Profile View -->
            <div id="member-profile-view" style="display: none;">
                <button class="btn btn-secondary" onclick="backToMemberList()" style="margin-bottom: 20px;">← Back to List</button>
                
                <h2>Member Profile</h2>
                
                <!-- View Mode (Read-only) -->
                <div id="member-view-mode">
                    <div class="form-row">
                        <div class="form-group">
                            <label style="font-weight: 600; color: #555;">Name</label>
                            <p id="view-name" style="padding: 10px 15px; background: #f8f9fa; border-radius: 8px; margin: 5px 0;"></p>
                        </div>
                        <div class="form-group">
                            <label style="font-weight: 600; color: #555;">Date of Birth</label>
                            <p id="view-dob" style="padding: 10px 15px; background: #f8f9fa; border-radius: 8px; margin: 5px 0;"></p>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button type="button" class="btn btn-primary" onclick="enableEditMode()">Edit Profile</button>
                        <button type="button" class="btn btn-secondary" onclick="exportMemberProfile()">📄 Export PDF</button>
                        <button type="button" class="btn" onclick="deleteMember()" style="background: #dc3545; border-color: #dc3545; color: white;">Delete Member</button>
                    </div>
                </div>
                
                <!-- Edit Mode -->
                <div id="member-edit-mode" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-first-name">First Name</label>
                            <input type="text" class="form-control" id="edit-first-name">
                        </div>
                        <div class="form-group">
                            <label for="edit-last-name">Last Name</label>
                            <input type="text" class="form-control" id="edit-last-name">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="edit-dob">Date of Birth</label>
                        <input type="date" class="form-control" id="edit-dob">
                    </div>
                    <div class="action-buttons">
                        <button type="button" class="btn btn-primary" onclick="saveMemberEdits()">Save Changes</button>
                        <button type="button" class="btn btn-secondary" onclick="cancelEdit()">Cancel</button>
                        <button type="button" class="btn btn-secondary" onclick="deleteMember()">Delete Member</button>
                    </div>
                </div>

                <div style="margin-top: 40px;">
                    <h3>Wellness Score Trend</h3>
                    <canvas id="trend-chart" width="600" height="300" style="max-width: 100%; border: 1px solid #e0e0e0; border-radius: 8px; padding: 10px; background: white;"></canvas>
                </div>

                <div style="margin-top: 40px;">
                    <h3>Evaluation History</h3>
                    <div style="margin-bottom: 10px;">
                        <button class="btn btn-primary" onclick="startEvaluationForMember()">New Evaluation</button>
                    </div>
                    <table class="segment-table" style="width: 100%;">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Score</th>
                                <th>Notes</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="member-evaluation-history">
                            <tr><td colspan="4" style="text-align: center; color: #999;">No evaluations yet</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Evaluation Tab -->
        <div id="evaluation-content" class="content-area hidden">
            <div class="evaluation-header">
                <div>
                    <h2>New Evaluation</h2>
                    <p id="eval-member-name" style="color: #666; margin-top: 5px;">Select a member to begin</p>
                </div>
                <div>
                    <div style="text-align: center;">
                        <div style="color: #666; font-size: 14px;">Overall Score</div>
                        <div class="overall-score" id="overall-score">0</div>
                    </div>
                </div>
            </div>

            <div id="member-select" style="margin-bottom: 30px;">
                <label class="form-group">
                    <span style="font-weight: 600; color: #555;">Select Member</span>
                    <select class="form-control" id="eval-member-select" onchange="selectMemberForEval()">
                        <option value="">Choose a member...</option>
                    </select>
                </label>
            </div>

            <div id="evaluation-form" style="display: none;">
                <!-- Groups will be dynamically inserted here -->
            </div>

            <div id="eval-notes-section" style="display: none; margin-top: 20px;">
                <div class="form-group">
                    <label for="eval-notes" style="font-weight: 600; color: #555; display: block; margin-bottom: 10px;">
                        Evaluation Notes
                        <button type="button" id="voice-record-btn" class="btn" title="Click to start/stop voice recording">
                            🎤 Record Voice Note
                        </button>
                        <span id="recording-status" style="display: none;">
                            🔴 Recording...
                        </span>
                    </label>
                    <textarea class="form-control" id="eval-notes" rows="3" placeholder="Add any observations or notes about this evaluation..."></textarea>
                    <div id="voice-transcript" style="display: none;">
                        <strong>Voice Transcript:</strong>
                        <div id="transcript-text" style="margin: 10px 0; padding: 10px; background: white; border-radius: 3px; border: 1px solid #ddd; min-height: 50px;"></div>
                        <div style="margin-top: 10px;">
                            <button type="button" class="btn btn-secondary" style="padding: 5px 10px; font-size: 12px; margin-right: 5px;" onclick="useTranscript()">Use Summary</button>
                            <button type="button" class="btn btn-secondary" style="padding: 5px 10px; font-size: 12px;" onclick="clearTranscript()">Clear</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="action-buttons" id="eval-actions" style="display: none;">
                <button class="btn btn-secondary" onclick="resetEvaluation()">Reset</button>
                <button class="btn btn-primary" onclick="saveEvaluation()">Save Evaluation</button>
            </div>
        </div>

        <!-- Results Tab -->
        <div id="results-content" class="content-area hidden">
            <div id="results-empty" style="text-align: center; padding: 40px; color: #999;">
                <p>No evaluation selected. Complete an evaluation to see results.</p>
            </div>
            <div id="results-view" style="display: none;">
                <h2 id="results-title">Evaluation Results</h2>
                
                <div class="results-grid">
                    <div class="score-gauge">
                        <div class="gauge-value" id="results-score">0</div>
                        <div style="color: #666; margin-top: 10px;">Wellness Score</div>
                    </div>
                    <div class="group-breakdown">
                        <h3>Segment Summary</h3>
                        <div id="group-breakdown-list">
                            <!-- Breakdown items will be inserted here -->
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <h3 style="margin-bottom: 10px;">Evaluation Notes</h3>
                    <p id="results-notes" style="color: #666; margin: 0;">No notes recorded for this evaluation.</p>
                </div>
                
                <!-- Trend Chart -->
                <div style="margin-top: 30px;">
                    <h3>Wellness Score Trend</h3>
                    <canvas id="results-trend-chart" width="600" height="300" style="max-width: 100%; border: 1px solid #e0e0e0; border-radius: 8px; padding: 10px; background: white;"></canvas>
                </div>
                
                <!-- Detailed Evaluation Table -->
                <div style="margin-top: 30px;">
                    <h3>Detailed Assessment Data</h3>
                    <div style="overflow-x: auto;">
                        <table class="segment-table" style="width: 100%; margin-top: 15px;">
                            <thead>
                                <tr>
                                    <th>Group</th>
                                    <th>Segment</th>
                                    <th>Pain</th>
                                    <th>ROM</th>
                                    <th>Strength</th>
                                    <th>Segment Score</th>
                                    <th>Modifier</th>
                                    <th>Group Total</th>
                                </tr>
                            </thead>
                            <tbody id="detailed-results-table">
                                <!-- Data will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="editCurrentEvaluation()">Edit Evaluation</button>
                    <button class="btn btn-secondary" id="delete-current-eval-btn" style="background: #dc3545; border-color: #dc3545;">Delete Evaluation</button>
                    <button class="btn btn-primary" onclick="startNewEvaluation()">New Evaluation</button>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-content" class="content-area hidden">
            <h2>Application Settings</h2>
            
            <div style="margin-bottom: 40px;">
                <h3>🤖 AI-Powered Voice Note Summarization</h3>
                <p style="color: #666; margin-bottom: 20px;">
                    Enable Claude AI to create intelligent, context-aware summaries of your voice notes with advanced medical terminology understanding.
                </p>
                
                <div class="form-group">
                    <label for="claude-api-key" style="font-weight: 600; color: #555;">
                        Anthropic Claude API Key
                        <span style="color: #dc3545;">*</span>
                    </label>
                    <input type="password" class="form-control" id="claude-api-key" 
                           placeholder="sk-ant-api03-..." 
                           style="font-family: monospace;">
                    <div style="margin-top: 8px; font-size: 14px; color: #666;">
                        <strong>🔒 Privacy:</strong> Your API key is stored locally and never shared. 
                        <a href="https://console.anthropic.com/" target="_blank" style="color: #667eea;">Get your API key here</a>
                    </div>
                </div>
                
                <div class="form-group">
                    <label style="font-weight: 600; color: #555; display: block; margin-bottom: 10px;">
                        AI Summarization Status
                    </label>
                    <div id="ai-status" style="padding: 15px; border-radius: 8px; background: #fff3cd; border: 1px solid #ffeaa7;">
                        <span style="color: #856404;">⚠️ Enter API key to enable AI summarization</span>
                    </div>
                </div>
                
                <div class="action-buttons" style="margin-top: 20px; border-top: none; padding-top: 0;">
                    <button class="btn btn-secondary" onclick="testClaudeConnection()">Test Connection</button>
                    <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <h4>🧠 AI vs Simple Summarization</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                        <div>
                            <h5 style="color: #28a745;">✅ With Claude AI</h5>
                            <ul style="font-size: 14px; color: #555;">
                                <li>Deep medical context understanding</li>
                                <li>Professional terminology recognition</li>
                                <li>Relationship analysis between symptoms</li>
                                <li>Structured clinical observations</li>
                                <li>Relevant recommendations</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: #856404;">⚠️ Simple Pattern Matching</h5>
                            <ul style="font-size: 14px; color: #555;">
                                <li>Basic keyword detection only</li>
                                <li>Limited medical vocabulary</li>
                                <li>No context understanding</li>
                                <li>Generic observations</li>
                                <li>No clinical insights</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="margin-bottom: 40px;">
                <h3>📊 Data Management</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <button class="btn btn-secondary" onclick="exportAllData()">📥 Export All Data</button>
                    <button class="btn btn-secondary" onclick="importData()" style="background: #28a745; border-color: #28a745;">📤 Import Data</button>
                </div>
                <input type="file" id="import-file" accept=".json" style="display: none;" onchange="handleDataImport(event)">
                
                <div style="margin-top: 20px; padding: 15px; background: #f8d7da; border-radius: 8px; border: 1px solid #f5c6cb;">
                    <h4 style="color: #721c24; margin-top: 0;">⚠️ Danger Zone</h4>
                    <button class="btn" onclick="clearAllData()" style="background: #dc3545; border-color: #dc3545; color: white;">
                        🗑️ Clear All Data
                    </button>
                    <div style="font-size: 14px; color: #721c24; margin-top: 8px;">
                        This will permanently delete all members and evaluations. Export your data first!
                    </div>
                </div>
            </div>
            
            <div>
                <h3>ℹ️ Application Info</h3>
                <div style="padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <p><strong>Version:</strong> 2.0.0</p>
                    <p><strong>Data Storage:</strong> Local Browser Storage</p>
                    <p><strong>Voice Recognition:</strong> <span id="voice-support-status">Checking...</span></p>
                    <p><strong>AI Summarization:</strong> <span id="ai-support-status">Disabled</span></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage - Store data in memory instead of localStorage for Claude artifacts
        let members = [];
        let evaluations = [];
        let currentEvaluation = null;
        let currentMemberId = null;
        let viewingEvaluationId = null;
        let editingExisting = false;
        let claudeApiKey = '';
        let useClaudeAI = false;

        // New simplified assessment segments
        const assessmentSegments = [
            'Spine',
            'Upper Extremity - Right',
            'Upper Extremity - Left', 
            'Lower Extremity - Right',
            'Lower Extremity - Left',
            'Posture',
            'Balance',
            'Gait'
        ];

        const functionLevels = {
            'Full Function': 12.5,
            'Minor Limitation': 9.5,
            'Modified Function': 6.5,
            'Restricted Function': 0
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('App initialized with assessment segments:', assessmentSegments);
            loadData();
            loadSettings(); // Load Claude API settings
            updateDashboard();
            setupEventListeners();
            
            // Initialize voice recording if available
            setTimeout(() => {
                const voiceBtn = document.getElementById('voice-record-btn');
                if (voiceBtn) {
                    voiceBtn.onclick = toggleRecording;
                    initSpeechRecognition();
                    console.log('Voice recording initialized');
                    
                    // Log voice feature status for debugging
                    const testResult = testVoiceFeature();
                    console.log('Voice feature test result:', testResult);
                    
                    if (!testResult.speechSupport) {
                        console.warn('Speech recognition not supported in this browser');
                    } else if (!testResult.secureContext) {
                        console.warn('Voice recording requires HTTPS or localhost');
                        voiceBtn.title = 'Voice recording requires HTTPS or localhost';
                    } else {
                        console.log('Voice recording should be fully functional');
                        voiceBtn.title = 'Click to start/stop voice recording';
                    }
                } else {
                    console.log('Voice button not found');
                }
            }, 100);
        });

        // Tab navigation
        function showTab(tab) {
            const tabs = ['dashboard', 'members', 'evaluation', 'results', 'settings'];
            tabs.forEach(t => {
                document.getElementById(`${t}-content`).classList.add('hidden');
                document.querySelector(`.nav-tab[onclick="showTab('${t}')"]`).classList.remove('active');
            });
            
            document.getElementById(`${tab}-content`).classList.remove('hidden');
            document.querySelector(`.nav-tab[onclick="showTab('${tab}')"]`).classList.add('active');
            
            document.getElementById(`${tab}-content`).classList.add('slide-in');
            
            // Update dashboard when switching to it
            if (tab === 'dashboard') {
                updateDashboard();
            }
            
            // Clear search when switching to members tab
            if (tab === 'members') {
                const searchInput = document.getElementById('member-list-search');
                if (searchInput) {
                    searchInput.value = '';
                    updateMemberList();
                }
            }
            
            // Update settings status when switching to settings
            if (tab === 'settings') {
                updateSettingsStatus();
            }
        }

        // Event listeners
        function setupEventListeners() {
            // No additional event listeners needed at startup
        }

        // Data persistence - Restore localStorage for real deployment
        function loadData() {
            try {
                // In the artifact environment, we'll start with demo data
                // In real deployment, you would uncomment localStorage lines below
                /*
                const savedMembers = localStorage.getItem('athletic-members-v2');
                const savedEvals = localStorage.getItem('athletic-evaluations-v2');
                
                if (savedMembers) members = JSON.parse(savedMembers);
                if (savedEvals) evaluations = JSON.parse(savedEvals);
                */
                
                // Load demo data if no saved data exists
                if (members.length === 0) {
                    loadDemoData();
                }
                
            } catch (error) {
                console.error('Error loading data:', error);
                // Fallback to demo data if localStorage fails
                loadDemoData();
            }
        }

        function loadDemoData() {
            // Demo members
            members = [
                {
                    id: 'demo-1',
                    firstName: 'John',
                    lastName: 'Smith',
                    dob: '1990-05-15',
                    createdAt: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString()
                },
                {
                    id: 'demo-2',
                    firstName: 'Sarah',
                    lastName: 'Johnson',
                    dob: '1988-08-22',
                    createdAt: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000).toISOString()
                }
            ];

            // Demo evaluations with new structure
            evaluations = [
                {
                    id: 'eval-1',
                    memberId: 'demo-1',
                    date: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                    overallScore: 87.5,
                    notes: 'Good overall performance. Some minor balance concerns noted.',
                    segments: {
                        'Spine': { functionLevel: 'Full Function', score: 12.5 },
                        'Upper Extremity - Right': { functionLevel: 'Full Function', score: 12.5 },
                        'Upper Extremity - Left': { functionLevel: 'Minor Limitation', score: 9.5 },
                        'Lower Extremity - Right': { functionLevel: 'Full Function', score: 12.5 },
                        'Lower Extremity - Left': { functionLevel: 'Full Function', score: 12.5 },
                        'Posture': { functionLevel: 'Full Function', score: 12.5 },
                        'Balance': { functionLevel: 'Minor Limitation', score: 9.5 },
                        'Gait': { functionLevel: 'Full Function', score: 12.5 }
                    }
                },
                {
                    id: 'eval-2',
                    memberId: 'demo-2',
                    date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                    overallScore: 74.5,
                    notes: 'Progress noted since last session. Continue current program.',
                    segments: {
                        'Spine': { functionLevel: 'Minor Limitation', score: 9.5 },
                        'Upper Extremity - Right': { functionLevel: 'Full Function', score: 12.5 },
                        'Upper Extremity - Left': { functionLevel: 'Full Function', score: 12.5 },
                        'Lower Extremity - Right': { functionLevel: 'Modified Function', score: 6.5 },
                        'Lower Extremity - Left': { functionLevel: 'Minor Limitation', score: 9.5 },
                        'Posture': { functionLevel: 'Minor Limitation', score: 9.5 },
                        'Balance': { functionLevel: 'Modified Function', score: 6.5 },
                        'Gait': { functionLevel: 'Minor Limitation', score: 9.5 }
                    }
                }
            ];
        }

        function saveData() {
            try {
                // In real deployment, uncomment these lines:
                // localStorage.setItem('athletic-members-v2', JSON.stringify(members));
                // localStorage.setItem('athletic-evaluations-v2', JSON.stringify(evaluations));
                console.log('Data saved successfully');
            } catch (error) {
                console.error('Error saving data:', error);
                // Could implement alternative storage here if needed
            }
        }

        // Member management
        function addMember(e) {
            if (e) e.preventDefault();
            
            try {
                console.log('Adding member...');
                
                const firstName = document.getElementById('first-name').value;
                const lastName = document.getElementById('last-name').value;
                const dob = document.getElementById('dob').value;
                
                if (!firstName || !lastName || !dob) {
                    alert('Please fill in all required fields');
                    return false;
                }
                
                const member = {
                    id: generateId(),
                    firstName: firstName,
                    lastName: lastName,
                    dob: dob,
                    createdAt: new Date().toISOString()
                };
                
                console.log('New member:', member);
                
                members.push(member);
                saveData();
                
                // Clear form
                document.getElementById('first-name').value = '';
                document.getElementById('last-name').value = '';
                document.getElementById('dob').value = '';
                
                updateMemberList();
                updateDashboard();
                updateMemberSelect();
                
                alert('Member added successfully!');
                return false;
            } catch (error) {
                console.error('Error adding member:', error);
                alert('Error adding member: ' + error.message);
            }
        }

        function updateMemberList(searchQuery = '') {
            const listEl = document.getElementById('member-list');
            
            if (members.length === 0) {
                listEl.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No members added yet.</p>';
                return;
            }
            
            // Filter members based on search query
            let filteredMembers = members;
            if (searchQuery) {
                const query = searchQuery.toLowerCase();
                filteredMembers = members.filter(member => 
                    `${member.firstName} ${member.lastName}`.toLowerCase().includes(query)
                );
            }
            
            if (filteredMembers.length === 0) {
                listEl.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No members found matching your search.</p>';
                return;
            }
            
            listEl.innerHTML = filteredMembers.map(member => `
                <div class="eval-item" onclick="viewMemberProfile('${member.id}')" style="cursor: pointer;">
                    <div>
                        <strong>${member.firstName} ${member.lastName}</strong>
                    </div>
                    <div style="color: #999; font-size: 14px;">
                        ${new Date(member.dob).toLocaleDateString()}
                    </div>
                </div>
            `).join('');
        }

        function searchMemberList() {
            const searchInput = document.getElementById('member-list-search');
            const searchQuery = searchInput ? searchInput.value : '';
            updateMemberList(searchQuery);
        }

        function updateMemberSelect() {
            const select = document.getElementById('eval-member-select');
            select.innerHTML = '<option value="">Choose a member...</option>' +
                members.map(member => 
                    `<option value="${member.id}">${member.firstName} ${member.lastName}</option>`
                ).join('');
        }

        // Evaluation management
        function selectMemberForEval() {
            const select = document.getElementById('eval-member-select');
            const memberId = select.value;
            
            if (!memberId) return;
            
            const member = members.find(m => m.id === memberId);
            document.getElementById('eval-member-name').textContent = 
                `${member.firstName} ${member.lastName} - ${new Date().toLocaleDateString()}`;
            
            initializeEvaluation(memberId);
            document.getElementById('evaluation-form').style.display = 'block';
            document.getElementById('eval-notes-section').style.display = 'block';
            document.getElementById('eval-actions').style.display = 'flex';
        }

        function initializeEvaluation(memberId) {
            console.log('Initializing evaluation with assessment segments:', assessmentSegments);
            
            currentEvaluation = {
                id: generateId(),
                memberId: memberId,
                date: new Date().toISOString(),
                segments: {}
            };
            
            const formEl = document.getElementById('evaluation-form');
            formEl.innerHTML = '';
            
            // Initialize each segment with "Full Function" as default
            assessmentSegments.forEach(segmentName => {
                currentEvaluation.segments[segmentName] = {
                    functionLevel: 'Full Function',
                    score: 12.5
                };
            });
            
            // Create the evaluation form
            const assessmentEl = createAssessmentForm();
            formEl.appendChild(assessmentEl);
            
            updateOverallScore();
        }

        function createAssessmentForm() {
            const div = document.createElement('div');
            div.className = 'assessment-section';
            div.innerHTML = `
                <div style="margin-bottom: 30px;">
                    <h3 style="margin-bottom: 20px; color: #667eea;">Functional Assessment</h3>
                    <table class="segment-table" style="width: 100%;">
                        <thead>
                            <tr>
                                <th style="width: 40%;">Assessment Area</th>
                                <th style="width: 60%;">Function Level</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${assessmentSegments.map(segmentName => `
                                <tr>
                                    <td style="font-weight: 600; padding: 15px 10px;">${segmentName}</td>
                                    <td style="padding: 10px;">
                                        <select class="form-control" id="segment-${segmentName.replace(/\s/g, '-').replace(/[^a-zA-Z0-9-]/g, '')}" 
                                                onchange="updateSegmentFunction('${segmentName}', this.value)"
                                                style="width: 100%; padding: 8px 12px;">
                                            ${Object.keys(functionLevels).map(level => `
                                                <option value="${level}" ${level === 'Full Function' ? 'selected' : ''}>${level}</option>
                                            `).join('')}
                                        </select>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            return div;
        }

        function updateSegmentFunction(segmentName, functionLevel) {
            if (!currentEvaluation || !currentEvaluation.segments[segmentName]) return;
            
            currentEvaluation.segments[segmentName].functionLevel = functionLevel;
            currentEvaluation.segments[segmentName].score = functionLevels[functionLevel];
            
            updateOverallScore();
        }

        function updateOverallScore() {
            if (!currentEvaluation) return;
            
            let overallScore = 0;
            
            Object.values(currentEvaluation.segments).forEach(segment => {
                overallScore += segment.score;
            });
            
            currentEvaluation.overallScore = overallScore;
            document.getElementById('overall-score').textContent = Math.round(overallScore);
        }

        function saveEvaluation() {
            if (!currentEvaluation) return;
            
            // Add notes to the evaluation
            const notesEl = document.getElementById('eval-notes');
            currentEvaluation.notes = notesEl ? notesEl.value || '' : '';
            
            // Add new evaluation
            evaluations.push(currentEvaluation);
            alert('Evaluation saved successfully!');
            
            saveData();
            
            // Update dashboard to reflect changes
            updateDashboard();
            
            // Show results
            showResults(currentEvaluation);
            showTab('results');
        }

        function resetEvaluation() {
            if (confirm('Are you sure you want to reset this evaluation?')) {
                if (currentEvaluation) {
                    initializeEvaluation(currentEvaluation.memberId);
                }
            }
        }

        function startNewEvaluation() {
            editingExisting = false;
            showTab('evaluation');
            document.getElementById('eval-member-select').value = '';
            document.getElementById('evaluation-form').style.display = 'none';
            document.getElementById('eval-notes-section').style.display = 'none';
            document.getElementById('eval-actions').style.display = 'none';
            document.getElementById('eval-member-name').textContent = 'Select a member to begin';
            document.getElementById('overall-score').textContent = '0';
            const notesEl = document.getElementById('eval-notes');
            if (notesEl) notesEl.value = '';
        }

        function showResults(evaluation) {
            const member = members.find(m => m.id === evaluation.memberId);
            
            viewingEvaluationId = evaluation.id;
            
            document.getElementById('results-empty').style.display = 'none';
            document.getElementById('results-view').style.display = 'block';
            
            document.getElementById('results-title').textContent = 
                `Evaluation Results - ${member.firstName} ${member.lastName} - ${new Date(evaluation.date).toLocaleDateString()}`;
            document.getElementById('results-score').textContent = Math.round(evaluation.overallScore);
            
            // Display notes
            const notesEl = document.getElementById('results-notes');
            if (evaluation.notes && evaluation.notes.trim()) {
                notesEl.textContent = evaluation.notes;
            } else {
                notesEl.innerHTML = '<em style="color: #999;">No notes recorded for this evaluation.</em>';
            }
            
            // Update segment breakdown
            const breakdownEl = document.getElementById('group-breakdown-list');
            breakdownEl.innerHTML = '';
            
            assessmentSegments.forEach(segmentName => {
                const segment = evaluation.segments[segmentName];
                const percentage = (segment.score / 12.5) * 100;
                
                const item = document.createElement('div');
                item.className = 'breakdown-item';
                item.innerHTML = `
                    <div style="min-width: 180px;">${segmentName}</div>
                    <div class="breakdown-bar">
                        <div class="breakdown-fill" style="width: ${percentage}%"></div>
                    </div>
                    <div style="min-width: 120px; text-align: right; font-weight: 600;">
                        ${segment.functionLevel}
                    </div>
                `;
                breakdownEl.appendChild(item);
            });
        }

        function viewEvaluation(evalId) {
            const evaluation = evaluations.find(e => e.id === evalId);
            if (evaluation) {
                showResults(evaluation);
                showTab('results');
            }
        }

        function editCurrentEvaluation() {
            if (!viewingEvaluationId) return;
            
            const evaluation = evaluations.find(e => e.id === viewingEvaluationId);
            if (!evaluation) return;
            
            editingExisting = true;
            currentEvaluation = JSON.parse(JSON.stringify(evaluation)); // Deep clone
            
            showTab('evaluation');
            
            // Set member selection
            const member = members.find(m => m.id === evaluation.memberId);
            document.getElementById('eval-member-select').value = evaluation.memberId;
            document.getElementById('eval-member-name').textContent = 
                `${member.firstName} ${member.lastName} - ${new Date(evaluation.date).toLocaleDateString()} (Editing)`;
            
            // Show forms
            document.getElementById('evaluation-form').style.display = 'block';
            document.getElementById('eval-notes-section').style.display = 'block';
            document.getElementById('eval-actions').style.display = 'flex';
            
            // Load existing data into form
            loadEvaluationIntoForm(evaluation);
            
            // Update overall score
            updateOverallScore();
        }

        function loadEvaluationIntoForm(evaluation) {
            const formEl = document.getElementById('evaluation-form');
            formEl.innerHTML = '';
            
            // Load notes
            const notesEl = document.getElementById('eval-notes');
            if (notesEl) {
                notesEl.value = evaluation.notes || '';
            }
            
            // Create the assessment form with existing data
            const assessmentEl = createAssessmentFormWithData(evaluation);
            formEl.appendChild(assessmentEl);
        }

        function createAssessmentFormWithData(evaluation) {
            const div = document.createElement('div');
            div.className = 'assessment-section';
            div.innerHTML = `
                <div style="margin-bottom: 30px;">
                    <h3 style="margin-bottom: 20px; color: #667eea;">Functional Assessment</h3>
                    <table class="segment-table" style="width: 100%;">
                        <thead>
                            <tr>
                                <th style="width: 40%;">Assessment Area</th>
                                <th style="width: 60%;">Function Level</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${assessmentSegments.map(segmentName => {
                                const segmentData = evaluation.segments[segmentName];
                                const currentLevel = segmentData ? segmentData.functionLevel : 'Full Function';
                                return `
                                    <tr>
                                        <td style="font-weight: 600; padding: 15px 10px;">${segmentName}</td>
                                        <td style="padding: 10px;">
                                            <select class="form-control" id="segment-${segmentName.replace(/\s/g, '-').replace(/[^a-zA-Z0-9-]/g, '')}" 
                                                    onchange="updateSegmentFunction('${segmentName}', this.value)"
                                                    style="width: 100%; padding: 8px 12px;">
                                                ${Object.keys(functionLevels).map(level => `
                                                    <option value="${level}" ${level === currentLevel ? 'selected' : ''}>${level}</option>
                                                `).join('')}
                                            </select>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            return div;
        }

        function saveEvaluation() {
            if (!currentEvaluation) return;
            
            // Add notes to the evaluation
            const notesEl = document.getElementById('eval-notes');
            currentEvaluation.notes = notesEl ? notesEl.value || '' : '';
            
            if (editingExisting) {
                // Update existing evaluation
                const index = evaluations.findIndex(e => e.id === currentEvaluation.id);
                if (index !== -1) {
                    evaluations[index] = currentEvaluation;
                    alert('Evaluation updated successfully!');
                }
                editingExisting = false;
            } else {
                // Add new evaluation
                evaluations.push(currentEvaluation);
                alert('Evaluation saved successfully!');
            }
            
            saveData();
            
            // Update dashboard to reflect changes
            updateDashboard();
            
            // Show results
            showResults(currentEvaluation);
            showTab('results');
        }

        function resetEvaluation() {
            if (confirm('Are you sure you want to reset this evaluation?')) {
                if (editingExisting && currentEvaluation) {
                    // If editing, reload the original data
                    const original = evaluations.find(e => e.id === currentEvaluation.id);
                    if (original) {
                        currentEvaluation = JSON.parse(JSON.stringify(original));
                        loadEvaluationIntoForm(currentEvaluation);
                        updateOverallScore();
                    }
                } else {
                    // If new evaluation, reset to defaults
                    if (currentEvaluation) {
                        initializeEvaluation(currentEvaluation.memberId);
                    }
                }
            }
        }

        // Dashboard updates
        function updateDashboard() {
            // Update member count
            document.getElementById('total-members').textContent = members.length;
            
            // Calculate weekly evaluations
            const now = new Date();
            const weekAgo = new Date(now.getTime() - (7 * 24 * 60 * 60 * 1000));
            
            const weeklyEvals = evaluations.filter(e => {
                const evalDate = new Date(e.date);
                return evalDate >= weekAgo && evalDate <= now;
            }).length;
            
            document.getElementById('weekly-evals').textContent = weeklyEvals;
            
            console.log('Dashboard updated - Total evals:', evaluations.length, 'Weekly:', weeklyEvals);
            
            updateRecentEvaluations();
            updateMemberList();
            updateMemberSelect();
        }

        function updateRecentEvaluations() {
            const recentEl = document.getElementById('recent-evals');
            
            if (evaluations.length === 0) {
                recentEl.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No evaluations yet. Start by adding a member!</p>';
                return;
            }
            
            // Sort by date and take last 10
            const recent = evaluations
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 10);
            
            recentEl.innerHTML = recent.map(eval => {
                const member = members.find(m => m.id === eval.memberId);
                
                let scoreClass = 'score-warning';
                if (eval.overallScore >= 80) scoreClass = 'score-good';
                else if (eval.overallScore < 60) scoreClass = 'score-danger';
                
                return `
                    <div class="eval-item" onclick="viewEvaluation('${eval.id}')">
                        <div>
                            <strong>${member ? `${member.firstName} ${member.lastName}` : 'Unknown Member'}</strong>
                            <div style="color: #666; font-size: 14px;">
                                ${new Date(eval.date).toLocaleDateString()}
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="score-badge ${scoreClass}">
                                ${Math.round(eval.overallScore)}
                            </span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Utility functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateDashboard();
        });

        // Member Profile Functions
        function viewMemberProfile(memberId) {
            currentMemberId = memberId;
            const member = members.find(m => m.id === memberId);
            
            if (!member) return;
            
            // Hide list view, show profile view
            document.getElementById('member-list-view').style.display = 'none';
            document.getElementById('member-profile-view').style.display = 'block';
            
            // Show view mode by default
            document.getElementById('member-view-mode').style.display = 'block';
            document.getElementById('member-edit-mode').style.display = 'none';
            
            // Populate view mode
            document.getElementById('view-name').textContent = `${member.firstName} ${member.lastName}`;
            document.getElementById('view-dob').textContent = new Date(member.dob).toLocaleDateString();
            
            // Load evaluation history and draw trend
            loadMemberEvaluationHistory(memberId);
            drawTrendChart(memberId);
        }

        function backToMemberList() {
            document.getElementById('member-list-view').style.display = 'block';
            document.getElementById('member-profile-view').style.display = 'none';
            currentMemberId = null;
        }

        function loadMemberEvaluationHistory(memberId) {
            const memberEvals = evaluations
                .filter(e => e.memberId === memberId)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const tbody = document.getElementById('member-evaluation-history');
            
            if (memberEvals.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #999;">No evaluations yet</td></tr>';
                return;
            }
            
            tbody.innerHTML = memberEvals.map(eval => {
                let scoreClass = 'score-warning';
                if (eval.overallScore >= 80) scoreClass = 'score-good';
                else if (eval.overallScore < 60) scoreClass = 'score-danger';
                
                return `
                    <tr>
                        <td>${new Date(eval.date).toLocaleDateString()}</td>
                        <td><span class="score-badge ${scoreClass}">${Math.round(eval.overallScore)}</span></td>
                        <td>${eval.notes || '<em>No notes</em>'}</td>
                        <td>
                            <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 14px; margin-right: 5px;" 
                                onclick="viewEvaluation('${eval.id}')">View</button>
                            <button class="btn btn-secondary btn-delete-eval" data-eval-id="${eval.id}" style="padding: 5px 10px; font-size: 14px; background: #dc3545; border-color: #dc3545;">Delete</button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.btn-delete-eval').forEach(btn => {
                btn.addEventListener('click', function() {
                    const evalId = this.getAttribute('data-eval-id');
                    deleteEvaluationFromHistory(evalId);
                });
            });
        }

        function drawTrendChart(memberId) {
            const canvas = document.getElementById('trend-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Get member's evaluations
            const memberEvals = evaluations
                .filter(e => e.memberId === memberId)
                .sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (memberEvals.length === 0) {
                ctx.fillStyle = '#999';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('No evaluations to display', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            if (memberEvals.length === 1) {
                ctx.fillStyle = '#999';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Need at least 2 evaluations to show trend', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            // Set up chart dimensions
            const padding = 50;
            const chartWidth = canvas.width - (padding * 2);
            const chartHeight = canvas.height - (padding * 2);
            
            // Find min and max scores for scaling
            const scores = memberEvals.map(e => e.overallScore);
            const minScore = Math.max(0, Math.min(...scores) - 10);
            const maxScore = Math.min(100, Math.max(...scores) + 10);
            
            // Draw axes
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 2;
            ctx.beginPath();
            // Y-axis
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            // X-axis
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();
            
            // Draw Y-axis labels (scores)
            ctx.fillStyle = '#666';
            ctx.font = '14px Arial';
            ctx.textAlign = 'right';
            for (let i = 0; i <= 5; i++) {
                const score = minScore + (maxScore - minScore) * (i / 5);
                const y = canvas.height - padding - (chartHeight * (i / 5));
                ctx.fillText(Math.round(score), padding - 10, y + 4);
                
                // Draw grid lines
                ctx.strokeStyle = '#f0f0f0';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(canvas.width - padding, y);
                ctx.stroke();
            }
            
            // Draw trend line
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            memberEvals.forEach((eval, index) => {
                const x = padding + (chartWidth * (index / (memberEvals.length - 1)));
                const y = canvas.height - padding - (chartHeight * ((eval.overallScore - minScore) / (maxScore - minScore)));
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();
            
            // Draw data points and labels
            memberEvals.forEach((eval, index) => {
                const x = padding + (chartWidth * (index / (memberEvals.length - 1)));
                const y = canvas.height - padding - (chartHeight * ((eval.overallScore - minScore) / (maxScore - minScore)));
                
                // Draw point
                ctx.fillStyle = '#667eea';
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw white center
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw score labels
                ctx.fillStyle = '#333';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(Math.round(eval.overallScore), x, y - 12);
                
                // Draw date labels
                ctx.fillStyle = '#666';
                ctx.font = '12px Arial';
                ctx.save();
                ctx.translate(x, canvas.height - padding + 25);
                ctx.rotate(-Math.PI / 6);
                ctx.textAlign = 'right';
                ctx.fillText(new Date(eval.date).toLocaleDateString(), 0, 0);
                ctx.restore();
            });
            
            // Draw chart title
            ctx.fillStyle = '#333';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Wellness Score Over Time', canvas.width / 2, 25);
        }

        function deleteEvaluationFromHistory(evalId) {
            if (confirm('Are you sure you want to delete this evaluation?')) {
                evaluations = evaluations.filter(e => e.id !== evalId);
                saveData();
                updateDashboard();
                
                // Refresh the member's evaluation history
                if (currentMemberId) {
                    loadMemberEvaluationHistory(currentMemberId);
                    drawTrendChart(currentMemberId);
                }
                
                alert('Evaluation deleted successfully!');
            }
        }

        function startEvaluationForMember() {
            if (!currentMemberId) return;
            
            // Switch to evaluation tab with this member pre-selected
            showTab('evaluation');
            document.getElementById('eval-member-select').value = currentMemberId;
            
            // Clear the notes field before initializing
            const notesEl = document.getElementById('eval-notes');
            if (notesEl) notesEl.value = '';
            
            selectMemberForEval();
        }
        // Placeholder functions for features not yet implemented
        function enableEditMode() { console.log('Enable edit mode'); }
        function cancelEdit() { console.log('Cancel edit'); }
        function saveMemberEdits() { console.log('Save member edits'); }
        function deleteMember() { console.log('Delete member'); }
        function exportResults() { console.log('Export results'); }
        function exportMemberProfile() { console.log('Export member profile'); }
        function downloadResults() { console.log('Download results'); }
        function deleteEvaluation() { console.log('Delete evaluation'); }
        function deleteCurrentEvaluation() { console.log('Delete current evaluation'); }
        function toggleRecording() { console.log('Toggle recording'); }
        function useTranscript() { console.log('Use transcript'); }
        function clearTranscript() { console.log('Clear transcript'); }
        function testVoiceFeature() { console.log('Test voice feature'); }
        function saveSettings() { console.log('Save settings'); }
        function testClaudeConnection() { console.log('Test Claude connection'); }
        function exportAllData() { console.log('Export all data'); }
        function importData() { console.log('Import data'); }
        function handleDataImport() { console.log('Handle data import'); }
        function clearAllData() { console.log('Clear all data'); }
        function showVoiceHelp() { console.log('Show voice help'); }
        function loadSettings() { console.log('Load settings'); }
        function updateSettingsStatus() { console.log('Update settings status'); }
        function initSpeechRecognition() { console.log('Init speech recognition'); }
    </script>
</body>
</html>
